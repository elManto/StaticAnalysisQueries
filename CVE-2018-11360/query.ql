import cpp
import semmle.code.cpp.dataflow.TaintTracking

from AssignExpr e, ForStmt f, ArrayExpr ae, Expr src, Variable v
where e.getEnclosingStmt() = f.getInitialization()
        and v.getAnAssignedValue() = e.getRValue()

        and TaintTracking::localTaint(
            DataFlow::exprNode(v.getAnAssignedValue()), 
            DataFlow::exprNode(ae.getArrayOffset()))

        and not ae.getBasicBlock().inLoop()

select ae, v

// One possible query that looks for off-by-one array accesses outside the loops
// that use the loop counter as an array offset
